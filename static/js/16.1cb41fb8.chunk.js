(this["webpackJsonp@rclone/rclone-webui"]=this["webpackJsonp@rclone/rclone-webui"]||[]).push([[16],{325:function(e,t,a){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],n=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(c){r=!0,i=c}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return a}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}a.d(t,"a",(function(){return n}))},370:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return s}));var n=a(77),r=a(4),i=a(53),o=function(){return function(e){n.a.post(i.a.getProviders).then((function(t){return e({type:r.w,payload:t.data.providers})}))}},s=function(){return function(e){n.a.post(i.a.getConfigDump).then((function(t){return e({type:r.t,status:r.I,payload:t.data})}),(function(t){return e({type:r.t,status:r.G,payload:t})}))}}},558:function(e,t,a){"use strict";var n,r=a(5),i=a(19),o=a(324),s=a(21),c=a(326),l=a(0),u=a.n(l),d=a(1),m=a.n(d),p=a(28),h=a.n(p),f=a(344),v=a(31),g=Object(c.a)({},f.Transition.propTypes,{isOpen:m.a.bool,children:m.a.oneOfType([m.a.arrayOf(m.a.node),m.a.node]),tag:v.q,className:m.a.node,navbar:m.a.bool,cssModule:m.a.object,innerRef:m.a.oneOfType([m.a.func,m.a.string,m.a.object])}),b=Object(c.a)({},f.Transition.defaultProps,{isOpen:!1,appear:!1,enter:!0,exit:!0,tag:"div",timeout:v.e.Collapse}),E=((n={})[v.d.ENTERING]="collapsing",n[v.d.ENTERED]="collapse show",n[v.d.EXITING]="collapsing",n[v.d.EXITED]="collapse",n);function O(e){return e.scrollHeight}var S=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={height:null},["onEntering","onEntered","onExit","onExiting","onExited"].forEach((function(e){a[e]=a[e].bind(Object(o.a)(a))})),a}Object(s.a)(t,e);var a=t.prototype;return a.onEntering=function(e,t){this.setState({height:O(e)}),this.props.onEntering(e,t)},a.onEntered=function(e,t){this.setState({height:null}),this.props.onEntered(e,t)},a.onExit=function(e){this.setState({height:O(e)}),this.props.onExit(e)},a.onExiting=function(e){e.offsetHeight;this.setState({height:0}),this.props.onExiting(e)},a.onExited=function(e){this.setState({height:null}),this.props.onExited(e)},a.render=function(){var e=this,t=this.props,a=t.tag,n=t.isOpen,o=t.className,s=t.navbar,l=t.cssModule,d=t.children,m=(t.innerRef,Object(i.a)(t,["tag","isOpen","className","navbar","cssModule","children","innerRef"])),p=this.state.height,g=Object(v.o)(m,v.c),b=Object(v.n)(m,v.c);return u.a.createElement(f.Transition,Object(r.a)({},g,{in:n,onEntering:this.onEntering,onEntered:this.onEntered,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}),(function(t){var n=function(e){return E[e]||"collapse"}(t),i=Object(v.m)(h()(o,n,s&&"navbar-collapse"),l),m=null===p?null:{height:p};return u.a.createElement(a,Object(r.a)({},b,{style:Object(c.a)({},b.style,{},m),className:i,ref:e.props.innerRef}),d)}))},t}(l.Component);S.propTypes=g,S.defaultProps=b,t.a=S},570:function(e,t,a){"use strict";var n=a(5),r=a(19),i=a(0),o=a.n(i),s=a(1),c=a.n(s),l=a(28),u=a.n(l),d=a(31),m={children:c.a.node,tag:d.q,className:c.a.string,cssModule:c.a.object,valid:c.a.bool,tooltip:c.a.bool},p={tag:"div",valid:void 0},h=function(e){var t=e.className,a=e.cssModule,i=e.valid,s=e.tooltip,c=e.tag,l=Object(r.a)(e,["className","cssModule","valid","tooltip","tag"]),m=s?"tooltip":"feedback",p=Object(d.m)(u()(t,i?"valid-"+m:"invalid-"+m),a);return o.a.createElement(c,Object(n.a)({},l,{className:p}))};h.propTypes=m,h.defaultProps=p,t.a=h},699:function(e,t,a){"use strict";a.r(t);var n=a(325),r=a(79),i=a.n(r),o=a(107),s=a(3),c=a(9),l=a(32),u=a(33),d=a(69),m=a(68),p=a(104),h=a(70),f=a(0),v=a.n(f),g=a(410),b=a(411),E=a(67),O=a(334),S=a(570),y=a(320),N=a(101),j=a(558),x=a(383),k=a(384),C=a(337),V=a(700),I=a(685),w=a(686),T=a(687),A=a(103),M=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).toggle=a.toggle.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"toggle",value:function(){this.props.closeModal()}},{key:"render",value:function(){var e=this.props.isVisible;return v.a.createElement("div",null,v.a.createElement(A.a,null,v.a.createElement(V.a,{isOpen:e,toggle:this.toggle},v.a.createElement(I.a,{toggle:this.toggle,"data-test":"modalHeader"},"Configuring your drive."),v.a.createElement(w.a,{"data-test":"modalBody"},"A page will open for you with the authentication for your drive. This modal will automatically dismiss upon successful creation"),v.a.createElement(T.a,{"data-test":"modalFooter"},v.a.createElement(C.a,{color:"primary",onClick:this.toggle},"Done")," "))))}}]),t}(v.a.Component);M.defaultProps={isVisible:!0};var P=M,D=a(77),R=a(78),q=a(409),F=a.n(q),H=function(e,t){var a=t.trim().toLowerCase(),n=a.length;return 0===n?e:0===n?[]:e.filter((function(e){return e.Description.toLowerCase().slice(0,n)===a}))},G=function(e){return e.Prefix},z=function(e){return v.a.createElement("div",null,e.Description)},J=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).onSuggestionsFetchRequested=function(e){var t=e.value;a.setState({suggestions:H(a.props.suggestions,t)})},a.onSuggestionsClearRequested=function(){a.setState({suggestions:[]})},a.state={suggestions:[]},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.value,a=e.onChange,n=e.suggestions,r=Object(R.f)(n,t),i={placeholder:"Type a provider type",value:void 0===r?t:r.Description,onChange:a};return v.a.createElement(F.a,{suggestions:this.state.suggestions,onSuggestionsFetchRequested:this.onSuggestionsFetchRequested,onSuggestionsClearRequested:this.onSuggestionsClearRequested,getSuggestionValue:G,renderSuggestion:z,alwaysRenderSuggestions:!0,highlightFirstSuggestion:!0,inputProps:i})}}]),t}(v.a.Component),L=a(105),U=a(370),X=a(102),B=a(44),W=a(53);function Y(e){var t=e.drivePrefix,a=e.loadAdvanced,n=e.changeHandler,r=e.currentValues,i=e.isValidMap,o=e.errorsMap,s=e.config;if(void 0!==t&&""!==t){var c=Object(R.f)(s,t),l=[];if(void 0!==c)l=c.Options.map((function(e,t){if(0===e.Hide&&(a&&e.Advanced||!a&&!e.Advanced)){var s="".concat(e.Help),c=e.Required?v.a.createElement("i",{className:"text-red"},"*"):null,l=!Object(R.j)(e.Examples),u=null,d="";return e.IsPassword?d="password":l?d="string":"bool"===e.Type?(d="select",u=[v.a.createElement("option",{key:1,value:!0},"Yes"),v.a.createElement("option",{key:2,value:!1},"No")]):d="int"===e.Type?"number":(e.Type,"text"),v.a.createElement(g.a,{key:t,row:!0},v.a.createElement(b.a,{for:e.Name,sm:5},s,c),v.a.createElement(E.a,{sm:7},v.a.createElement(O.a,{type:d,value:r[e.Name],name:e.Name,valid:i[e.Name],invalid:!i[e.Name],id:e.Name,onChange:n,required:e.Required},u),v.a.createElement(S.a,null,o[e.Name])))}return null}));return l}return v.a.createElement("div",null,"Select a drive type to continue")}function _(e){var t=e.key,a=e.id,n=e.label,r=e.changeHandler,i=e.type,o=e.value,s=e.name,c=e.placeholder,l=e.isValid,u=void 0!==l&&l;return v.a.createElement(g.a,{key:t,row:!0},v.a.createElement(b.a,{for:a,sm:5},n),v.a.createElement(E.a,{sm:7},v.a.createElement(O.a,{type:i,value:o,name:s,placeholder:c,id:a,onChange:r,valid:u,invalid:!u,required:!0}),v.a.createElement(S.a,{valid:!0},"Sweet! that name is available"),v.a.createElement(S.a,null,"Sad! That name is already assigned or empty")))}var K=function(e){function t(e,a){var n;return Object(l.a)(this,t),(n=Object(d.a)(this,Object(m.a)(t).call(this,e,a))).toggle=function(e){var t=e.target.name;n.setState(Object(c.a)({},t,!n.state[t]))},n.handleInputChange=function(e){var t=e.target.name,a=e.target.value,r=n.state.optionTypes[t];n.setState({formValues:Object(s.a)({},n.state.formValues,Object(c.a)({},t,a))});var i=!0,o="";"SizeSuffix"===r?(i=Object(R.q)(a))||(o="The valid input is size( off | {unit}{metric} eg: 10G, 100M, 10G100M etc.)"):"Duration"===r?(i=Object(R.o)(a))||(o="The valid input is time ({unit}{metric} eg: 10ms, 100m, 10h15ms etc.)"):"int"===r&&((i=Object(R.p)(a))||(o="The valid input is int (100,200,300 etc)")),!n.state.required[t]||a&&""!==a||(i=!1)||(o+=" This field is required"),n.setState((function(e){return{isValid:Object(s.a)({},e.isValid,Object(c.a)({},t,i)),formErrors:Object(s.a)({},e.formErrors,Object(c.a)({},t,o))}}))},n.changeDriveType=function(e,t){var a=t.newValue,r=n.props.providers,i=a,o={},s={},c={},l={},u={};if(void 0!==i&&""!==i){var d=Object(R.f)(r,i);void 0!==d&&d.Options.forEach((function(e){var t=e.DefaultStr,a=e.Type,n=e.Name,r=e.Required;0===e.Hide&&(o[n]=t,s[n]=a,u[n]=r,c[n]=!(r&&(!t||""===t)),l[n]="")})),n.setState({drivePrefix:i,formValues:o,optionTypes:s,isValid:c,formErrors:l,required:u})}else n.setState({drivePrefix:i})},n.openSetupDrive=function(e){e&&e.preventDefault(),n.setState({colSetup:!0})},n.editAdvancedOptions=function(e){n.setState({advancedOptions:!n.state.advancedOptions})},n.clearForm=function(e){n.setState({driveName:"",drivePrefix:""})},n.changeName=function(e){var t=n.state.driveNameIsEditable,a=e.target.value;t&&Object(R.n)(a)?n.setState({driveName:a},(function(){void 0===a||""===a?n.setState({driveNameIsValid:!1}):D.a.post(W.a.getConfigForRemote,{name:a}).then((function(e){var t=n.state.formErrors,a=Object(R.j)(e.data);t.driveName=a?"":"Duplicate",n.setState({formErrors:t,driveNameIsValid:a})}))})):n.setState((function(e){return{formErrors:Object(s.a)({},e.formErrors,{driveName:"Cannot edit name"})}}))},n.openAdvancedSettings=function(e){n.state.advancedOptions?n.setState({colAdvanced:!0}):n.configEndDiv.scrollIntoView({behavior:"smooth"})},n.gotoNextStep=function(){var e=n.state,t=e.currentStepNumber,a=e.advancedOptions;a&&3===t||!a&&2===t?n.handleSubmit(null):n.setCurrentStep(t+1)},n.gotoPrevStep=function(){var e=n.state.currentStepNumber;n.setCurrentStep(e-1)},n.setCurrentStep=function(e){n.setState({currentStepNumber:e})},n.StepShowCase=function(e){var t=e.currentStepNumber,a=["Set up Remote Config","Set up Drive","Advanced Config"];return v.a.createElement(y.a,{className:"timeline"},v.a.createElement(N.a,null,a.map((function(e,r){return r+=1,v.a.createElement(v.a.Fragment,{key:r},v.a.createElement(E.a,{className:"text-center "+(t===r?"step-active":""),md:2,sm:4},v.a.createElement("button",{className:"btn btn-step-count",onClick:function(){return n.setCurrentStep(r)}},r),v.a.createElement("h4",null,e)),r!==a.length&&v.a.createElement(E.a,{md:3,className:"d-none d-md-block"},v.a.createElement("div",{className:"timeline-divider align-middle"})))}))))},n.state={colRconfig:!0,colSetup:!1,colAdvanced:!1,driveName:"",driveNameIsEditable:!0,advancedOptions:!1,formValues:{},formValuesValid:{},required:{},authModalIsVisible:!1,drivePrefix:"",driveNameIsValid:!1,formErrors:{driveName:""},optionTypes:{},isValid:{},currentStepNumber:1},n.configCheckInterval=null,n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n.toggleAuthModal=n.toggleAuthModal.bind(Object(p.a)(n)),n.startAuthentication=n.startAuthentication.bind(Object(p.a)(n)),n.checkConfigStatus=n.checkConfigStatus.bind(Object(p.a)(n)),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"checkConfigStatus",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.driveName,e.prev=1,e.next=4,D.a.post(W.a.getConfigForRemote,{name:t});case 4:a=e.sent,Object(R.j)(a.data)||(clearInterval(this.configCheckInterval),this.configCheckInterval=null,this.toggleAuthModal(),this.props.history.push("/dashboard")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),L.b.error("Error creating config. ".concat(e.t0),{autoClose:!1});case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"validateForm",value:function(){var e=this.state,t=e.driveNameIsValid,a=e.drivePrefix,r=e.isValid,i=!0;t||(i=!1),""===a&&(i=!1);for(var o=0,s=Object.entries(r);o<s.length;o++){var c=Object(n.a)(s[o],2),l=c[0],u=c[1];if(!l||!u){i=!1;break}}return i}},{key:"toggleAuthModal",value:function(){this.setState((function(e,t){return{authModalIsVisible:!e.authModalIsVisible}}))}},{key:"startAuthentication",value:function(){this.toggleAuthModal(),null===this.configCheckInterval?this.configCheckInterval=setInterval(this.checkConfigStatus,B.e):console.error("Interval already running. Should not start a new one")}},{key:"stopAuthentication",value:function(){this.setState((function(e,t){return{authModalIsVisible:!1}})),clearInterval(this.configCheckInterval)}},{key:"handleSubmit",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var a,r,o,s,c,l,u,d,m,p,h;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.preventDefault(),a=this.state,r=a.formValues,o=a.drivePrefix,s=this.props.providers,!this.validateForm()){e.next=39;break}if(void 0===o||""===o){e.next=37;break}if(void 0===(c=Object(R.f)(s,o))){e.next=37;break}l=c.Options,u={},d=function(){var e=Object(n.a)(p[m],2),t=e[0],a=e[1];if("token"===t)return u[t]=a,"continue";var r=l.find((function(e,a,n){return t===e.Name}));r&&(a!==r.DefaultStr&&(u[t]=a))},m=0,p=Object.entries(r);case 11:if(!(m<p.length)){e.next=18;break}if("continue"!==d()){e.next=15;break}return e.abrupt("continue",15);case 15:m++,e.next=11;break;case 18:if(h={parameters:u,name:this.state.driveName,type:this.state.drivePrefix},this.startAuthentication(),e.prev=20,this.props.match.params.drivePrefix){e.next=28;break}return e.next=25,D.a.post(W.a.createConfig,h);case 25:L.b.info("Config created"),e.next=31;break;case 28:return e.next=30,D.a.post(W.a.updateConfig,h);case 30:L.b.info("Config Updated");case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(20),L.b.error("Error creating config. ".concat(e.t0),{autoClose:!1}),this.stopAuthentication();case 37:e.next=40;break;case 39:L.b.warn("Check for errors before submitting.",{autoClose:!1});case 40:case"end":return e.stop()}}),e,this,[[20,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.drivePrefix;(!this.props.providers||this.props.providers.length<1)&&this.props.getProviders(),t&&(this.setState({driveName:t,driveNameIsValid:!0,driveNameIsEditable:!1}),D.a.post(W.a.getConfigForRemote,{name:t}).then((function(t){console.log(t),e.changeDriveType(void 0,{newValue:t.data.type}),e.setState((function(e){return{formValues:Object(s.a)({},e.formValues,{},t.data)}}))})))}},{key:"componentWillUnmount",value:function(){clearInterval(this.configCheckInterval),this.configCheckInterval=null}},{key:"render",value:function(){var e=this.state,t=e.drivePrefix,a=e.advancedOptions,n=e.driveName,r=e.driveNameIsValid,i=e.currentStepNumber,o=this.props.providers;return v.a.createElement("div",{"data-test":"newDriveComponent"},v.a.createElement(A.a,null,v.a.createElement("p",null,"This 3 step process will guide you through creating a new config. For auto config, leave the parameters as it is."),v.a.createElement(this.StepShowCase,{currentStepNumber:i}),v.a.createElement(j.a,{isOpen:1===i},v.a.createElement(x.a,null,v.a.createElement(k.a,null,v.a.createElement(_,{label:"Name of this drive (For your reference)",changeHandler:this.changeName,value:n,placeholder:"Enter a name",name:"name",id:"driveName",isValid:r}),v.a.createElement(g.a,{row:!0},v.a.createElement(b.a,{for:"driveType",sm:5},"Select"),v.a.createElement(E.a,{sm:7},v.a.createElement(J,{suggestions:o,value:t,onChange:this.changeDriveType}))),v.a.createElement(g.a,{row:!0},v.a.createElement(E.a,{sm:3},v.a.createElement(b.a,{for:"inputDriveName"},"Docs are available at ")," ",v.a.createElement("a",{href:"https://rclone.org/commands/rclone_config/"},"Rclone Config"))),v.a.createElement("div",{className:"clearfix"},v.a.createElement("div",{className:"float-right"},v.a.createElement(C.a,{className:"ml-3 btn-blue",onClick:this.gotoNextStep},"Next")))))),v.a.createElement(j.a,{isOpen:2===i},v.a.createElement(x.a,null,v.a.createElement(k.a,null,v.a.createElement(Y,{drivePrefix:t,loadAdvanced:!1,changeHandler:this.handleInputChange,errorsMap:this.state.formErrors,isValidMap:this.state.isValid,currentValues:this.state.formValues,config:o}),v.a.createElement("div",{className:"clearfix"},v.a.createElement("div",{className:"float-right"},v.a.createElement(O.a,{type:"checkbox",value:a,onChange:this.editAdvancedOptions}),v.a.createElement("span",{className:"mr-3"},"Edit Advanced Options"),v.a.createElement(C.a,{className:"btn-no-background",onClick:this.gotoPrevStep},"Go back"),v.a.createElement(C.a,{className:"ml-3 btn-blue",onClick:this.gotoNextStep},"Next")))))),v.a.createElement(j.a,{isOpen:3===i},v.a.createElement(x.a,null,v.a.createElement(k.a,null,v.a.createElement(Y,{drivePrefix:t,loadAdvanced:!0,changeHandler:this.handleInputChange,errorsMap:this.state.formErrors,isValidMap:this.state.isValid,currentValues:this.state.formValues,config:o}),v.a.createElement("div",{className:"clearfix"},v.a.createElement("div",{className:"float-right"},v.a.createElement(O.a,{type:"checkbox",value:a,onChange:this.editAdvancedOptions}),v.a.createElement("span",{className:"mr-3"},"Edit Advanced Options"),v.a.createElement(C.a,{className:"btn-no-background",onClick:this.gotoPrevStep},"Go back"),v.a.createElement(C.a,{className:"ml-3 btn-blue",onClick:this.gotoNextStep},"Next")))))),v.a.createElement(P,{isVisible:this.state.authModalIsVisible,closeModal:this.toggleAuthModal})))}}]),t}(v.a.Component);K.defaultProps={isEdit:!1};t.default=Object(X.b)((function(e){return{providers:e.config.providers}}),{getProviders:U.b})(K)}}]);
//# sourceMappingURL=16.1cb41fb8.chunk.js.map